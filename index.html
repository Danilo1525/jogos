<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpaceShock Evolution</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            background: #000;
            font-family: 'Audiowide', cursive;
            color: #fff;
            user-select: none;
        }
        
        #gameCanvas {
            display: block;
            background: radial-gradient(ellipse at center, #0a0e24 0%, #000000 100%);
        }
        
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 16px;
            text-shadow: 0 0 5px #00f, 0 0 10px #0066ff;
            pointer-events: none;
            background: rgba(0, 0, 30, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        
        #waveInfo {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 16px;
            text-shadow: 0 0 5px #00f, 0 0 10px #0066ff;
            pointer-events: none;
            background: rgba(0, 0, 30, 0.5);
            padding: 10px;
            border-radius: 5px;
            text-align: right;
        }
        
        #levelBar {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 200px;
            height: 20px;
            background: rgba(0, 0, 50, 0.5);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #levelProgress {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #0066ff, #00ccff);
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        #levelText {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 20px;
            font-size: 14px;
            text-shadow: 0 0 3px #000;
        }
        
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 30, 0.8);
            z-index: 100;
        }
        
        #startScreen h1 {
            font-size: 5rem;
            margin-bottom: 2rem;
            color: #fff;
            text-shadow: 0 0 10px #00f, 0 0 20px #0066ff, 0 0 30px #0033ff;
            animation: pulse 2s infinite;
        }
        
        #startButton {
            padding: 15px 40px;
            font-size: 1.5rem;
            background: linear-gradient(to right, #0066ff, #00ccff);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 15px #0066ff;
            margin-bottom: 20px;
        }
        
        #startButton:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px #00ccff;
        }
        
        #shopButton {
            padding: 10px 30px;
            font-size: 1rem;
            background: linear-gradient(to right, #ff6600, #ff9900);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 10px #ff6600;
        }
        
        #shopButton:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #ff9900;
        }
        
        #shopScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 50, 0.9);
            z-index: 200;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
        }
        
        .shop-item {
            background: rgba(0, 30, 60, 0.7);
            border: 1px solid #0066ff;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            width: 80%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .shop-item h3 {
            color: #00ccff;
            margin-bottom: 10px;
        }
        
        .shop-item button {
            padding: 8px 20px;
            background: linear-gradient(to right, #00aa00, #00cc00);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .shop-item button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        #closeShop {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: linear-gradient(to right, #ff3300, #ff6600);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }
        
        #skinSelection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        .skin-option {
            width: 80px;
            height: 80px;
            margin: 10px;
            border: 2px solid transparent;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 60, 120, 0.5);
            transition: all 0.3s;
        }
        
        .skin-option:hover {
            border-color: #00ccff;
        }
        
        .skin-option.selected {
            border-color: #00ff00;
            box-shadow: 0 0 15px #00ff00;
        }
        
        .boss-health {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 20px;
            background: rgba(255, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        
        .boss-health-bar {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #ff0000, #ff6600);
            border-radius: 10px;
        }
        
        .boss-name {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: #ff0000;
            text-shadow: 0 0 5px #000;
            display: none;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        
        .floating-text {
            position: absolute;
            color: #fff;
            font-size: 20px;
            text-shadow: 0 0 5px #000;
            animation: floatUp 1.5s forwards;
            pointer-events: none;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui">
        <div>Score: <span id="score">0</span></div>
        <div>Level: <span id="level">1</span></div>
        <div>Health: <span id="health">100</span>%</div>
        <div>Coins: <span id="coins">0</span></div>
    </div>
    
    <div id="waveInfo">
        <div>Wave: <span id="wave">1</span></div>
        <div>Enemies: <span id="enemiesLeft">0</span></div>
    </div>
    
    <div id="levelBar">
        <div id="levelProgress"></div>
        <div id="levelText">Level Progress</div>
    </div>
    
    <div class="boss-health" id="bossHealth">
        <div class="boss-health-bar" id="bossHealthBar"></div>
    </div>
    <div class="boss-name" id="bossName"></div>
    
    <div id="startScreen">
        <h1>SPACESHOCK EVOLUTION</h1>
        <button id="startButton">INICIAR MISSÃO</button>
        <button id="shopButton">LOJA DE MELHORIAS</button>
    </div>
    
    <div id="shopScreen">
        <h2>LOJA DE MELHORIAS</h2>
        <div>Moedas: <span id="shopCoins">0</span></div>
        
        <div class="shop-item">
            <h3>Saúde Máxima</h3>
            <div>Nível: <span id="healthLevel">1</span>/10</div>
            <div>Custo: <span id="healthCost">100</span> moedas</div>
            <button id="upgradeHealth">Melhorar</button>
        </div>
        
        <div class="shop-item">
            <h3>Dano do Tiro</h3>
            <div>Nível: <span id="damageLevel">1</span>/10</div>
            <div>Custo: <span id="damageCost">100</span> moedas</div>
            <button id="upgradeDamage">Melhorar</button>
        </div>
        
        <div class="shop-item">
            <h3>Velocidade de Tiro</h3>
            <div>Nível: <span id="fireRateLevel">1</span>/10</div>
            <div>Custo: <span id="fireRateCost">100</span> moedas</div>
            <button id="upgradeFireRate">Melhorar</button>
        </div>
        
        <div class="shop-item">
            <h3>Velocidade da Nave</h3>
            <div>Nível: <span id="speedLevel">1</span>/10</div>
            <div>Custo: <span id="speedCost">100</span> moedas</div>
            <button id="upgradeSpeed">Melhorar</button>
        </div>
        
        <div class="shop-item">
            <h3>Vida Extra</h3>
            <div>Custo: <span id="extraLifeCost">500</span> moedas</div>
            <div>Disponível: <span id="extraLives">0</span>/3</div>
            <button id="buyExtraLife">Comprar</button>
        </div>
        
        <h3 style="margin-top: 30px;">SKINS DA NAVE</h3>
        <div id="skinSelection">
            <div class="skin-option selected" data-skin="default">
                <div style="width: 40px; height: 20px; background: #00ccff;"></div>
            </div>
            <div class="skin-option" data-skin="red">
                <div style="width: 40px; height: 20px; background: #ff3333;"></div>
            </div>
            <div class="skin-option" data-skin="green">
                <div style="width: 40px; height: 20px; background: #33ff33;"></div>
            </div>
            <div class="skin-option" data-skin="purple">
                <div style="width: 40px; height: 20px; background: #cc33ff;"></div>
            </div>
            <div class="skin-option" data-skin="gold">
                <div style="width: 40px; height: 20px; background: #ffcc00;"></div>
            </div>
        </div>
        
        <button id="closeShop">Fechar Loja</button>
    </div>

    <script>
        // Configurações do jogo
        const config = {
            playerSpeed: 6,
            bulletSpeed: 10,
            starCount: 200,
            powerupChance: 0.15,
            levelThreshold: 1000,
            coinsPerKill: 5,
            coinsPerWave: 50,
            baseEnemiesPerWave: 5,
            waveMultiplier: 1.2,
            bossWaveInterval: 5
        };

        // Estado do jogo
        const game = {
            canvas: null,
            ctx: null,
            lastTime: 0,
            score: 0,
            coins: 0,
            level: 1,
            levelProgress: 0,
            wave: 1,
            enemiesLeft: 0,
            gameOver: false,
            paused: false,
            particles: [],
            stars: [],
            enemies: [],
            bullets: [],
            powerups: [],
            explosions: [],
            keys: {},
            upgrades: {
                health: { level: 1, max: 10, cost: 100, costMultiplier: 1.5 },
                damage: { level: 1, max: 10, cost: 100, costMultiplier: 1.5 },
                fireRate: { level: 1, max: 10, cost: 100, costMultiplier: 1.5 },
                speed: { level: 1, max: 10, cost: 100, costMultiplier: 1.5 },
                extraLives: { count: 0, max: 3, cost: 500, costMultiplier: 2 }
            },
            player: {
                x: 0,
                y: 0,
                width: 50,
                height: 30,
                color: '#00ccff',
                health: 100,
                maxHealth: 100,
                lastShot: 0,
                shootDelay: 300,
                skin: 'default',
                skins: {
                    default: { color: '#00ccff', engineColor: '#ff9900' },
                    red: { color: '#ff3333', engineColor: '#ff6600' },
                    green: { color: '#33ff33', engineColor: '#00ff00' },
                    purple: { color: '#cc33ff', engineColor: '#9900ff' },
                    gold: { color: '#ffcc00', engineColor: '#ff9900' }
                }
            },
            bossActive: false,
            currentBoss: null
        };

        // Inicialização do jogo
        function init() {
            game.canvas = document.getElementById('gameCanvas');
            game.ctx = game.canvas.getContext('2d');
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Event listeners
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            document.getElementById('startButton').addEventListener('click', startGame);
            document.getElementById('shopButton').addEventListener('click', openShop);
            document.getElementById('closeShop').addEventListener('click', closeShop);
            
            // Botões de upgrade
            document.getElementById('upgradeHealth').addEventListener('click', () => upgradeStat('health'));
            document.getElementById('upgradeDamage').addEventListener('click', () => upgradeStat('damage'));
            document.getElementById('upgradeFireRate').addEventListener('click', () => upgradeStat('fireRate'));
            document.getElementById('upgradeSpeed').addEventListener('click', () => upgradeStat('speed'));
            document.getElementById('buyExtraLife').addEventListener('click', buyExtraLife);
            
            // Seleção de skins
            document.querySelectorAll('.skin-option').forEach(skin => {
                skin.addEventListener('click', () => {
                    document.querySelectorAll('.skin-option').forEach(s => s.classList.remove('selected'));
                    skin.classList.add('selected');
                    game.player.skin = skin.dataset.skin;
                });
            });
            
            createStars();
            renderStartScreen();
        }

        function resizeCanvas() {
            game.canvas.width = window.innerWidth;
            game.canvas.height = window.innerHeight;
            
            // Posiciona o jogador no centro
            game.player.x = game.canvas.width / 2 - game.player.width / 2;
            game.player.y = game.canvas.height - 100;
        }

        function renderStartScreen() {
            game.ctx.fillStyle = 'rgba(0, 0, 30, 0.8)';
            game.ctx.fillRect(0, 0, game.canvas.width, game.canvas.height);
            
            // Efeito de estrelas na tela inicial
            game.stars.forEach(star => {
                game.ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                game.ctx.fillRect(star.x, star.y, star.size, star.size);
            });
        }

        function createStars() {
            for (let i = 0; i < config.starCount; i++) {
                game.stars.push({
                    x: Math.random() * game.canvas.width,
                    y: Math.random() * game.canvas.height,
                    size: Math.random() * 3,
                    opacity: Math.random(),
                    speed: 0.1 + Math.random() * 2
                });
            }
        }

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            resetGameState();
            startWave();
            requestAnimationFrame(gameLoop);
        }

        function resetGameState() {
            game.score = 0;
            game.coins = 0;
            game.level = 1;
            game.levelProgress = 0;
            game.wave = 1;
            game.player.health = game.player.maxHealth;
            game.gameOver = false;
            game.enemies = [];
            game.bullets = [];
            game.powerups = [];
            game.bossActive = false;
            
            updateUI();
        }

        function startWave() {
            const isBossWave = game.wave % config.bossWaveInterval === 0;
            
            if (isBossWave) {
                spawnBoss();
                game.enemiesLeft = 1;
            } else {
                const baseEnemies = Math.floor(config.baseEnemiesPerWave * Math.pow(config.waveMultiplier, game.wave - 1));
                game.enemiesLeft = baseEnemies;
                
                // Spawn inicial de inimigos
                const initialSpawn = Math.min(5 + Math.floor(game.wave / 2), baseEnemies);
                for (let i = 0; i < initialSpawn; i++) {
                    setTimeout(() => spawnEnemy(), i * 1000);
                }
            }
            
            updateWaveInfo();
        }

        function spawnBoss() {
            game.bossActive = true;
            const bossType = Math.floor(game.wave / config.bossWaveInterval);
            
            let boss;
            switch (bossType % 3) {
                case 0:
                    boss = {
                        name: "Nave Mãe Alpha",
                        width: 120,
                        height: 80,
                        health: 50 + (bossType * 30),
                        maxHealth: 50 + (bossType * 30),
                        speed: 1 + (bossType * 0.3),
                        color: '#ff3366',
                        value: 200 * bossType,
                        pattern: 'horizontal',
                        shootDelay: 1500,
                        lastShot: 0,
                        bullets: 3
                    };
                    break;
                case 1:
                    boss = {
                        name: "Destruidor Beta",
                        width: 80,
                        height: 120,
                        health: 80 + (bossType * 40),
                        maxHealth: 80 + (bossType * 40),
                        speed: 0.8 + (bossType * 0.2),
                        color: '#6633ff',
                        value: 250 * bossType,
                        pattern: 'vertical',
                        shootDelay: 2000,
                        lastShot: 0,
                        bullets: 5
                    };
                    break;
                case 2:
                    boss = {
                        name: "Titã Gama",
                        width: 150,
                        height: 150,
                        health: 100 + (bossType * 50),
                        maxHealth: 100 + (bossType * 50),
                        speed: 0.5 + (bossType * 0.1),
                        color: '#ffcc00',
                        value: 300 * bossType,
                        pattern: 'spiral',
                        shootDelay: 2500,
                        lastShot: 0,
                        bullets: 8
                    };
                    break;
            }
            
            boss.x = game.canvas.width / 2 - boss.width / 2;
            boss.y = -boss.height;
            
            game.currentBoss = boss;
            game.enemies.push(boss);
            
            // Mostra UI do boss
            document.getElementById('bossName').textContent = boss.name;
            document.getElementById('bossName').style.display = 'block';
            document.getElementById('bossHealth').style.display = 'block';
            updateBossHealth();
        }

        function updateBossHealth() {
            if (!game.currentBoss) return;
            
            const healthPercent = (game.currentBoss.health / game.currentBoss.maxHealth) * 100;
            document.getElementById('bossHealthBar').style.width = `${healthPercent}%`;
        }

        function spawnEnemy() {
            if (game.enemiesLeft <= 0) return;
            
            const size = 30 + Math.random() * 20;
            const type = Math.random() > 0.9 ? 'elite' : 'normal';
            const side = Math.floor(Math.random() * 4); // 0: top, 1: right, 2: bottom, 3: left
            
            let x, y;
            switch (side) {
                case 0: // top
                    x = Math.random() * (game.canvas.width - size);
                    y = -size;
                    break;
                case 1: // right
                    x = game.canvas.width;
                    y = Math.random() * (game.canvas.height - size);
                    break;
                case 2: // bottom (apenas para níveis altos)
                    if (game.wave > 3) {
                        x = Math.random() * (game.canvas.width - size);
                        y = game.canvas.height;
                    } else {
                        x = Math.random() * (game.canvas.width - size);
                        y = -size;
                    }
                    break;
                case 3: // left
                    x = -size;
                    y = Math.random() * (game.canvas.height - size);
                    break;
            }
            
            const enemy = {
                x: x,
                y: y,
                width: size,
                height: size,
                speed: 1 + Math.random() * 2 + game.wave * 0.1,
                health: type === 'elite' ? 3 + Math.floor(game.wave / 2) : 1,
                maxHealth: type === 'elite' ? 3 + Math.floor(game.wave / 2) : 1,
                color: type === 'elite' ? '#ff5555' : '#ff0000',
                type: type,
                shootDelay: type === 'elite' ? 2000 - (game.wave * 50) : 4000 - (game.wave * 50),
                lastShot: 0,
                value: type === 'elite' ? 50 + (game.wave * 5) : 20 + (game.wave * 2),
                direction: Math.random() * Math.PI * 2
            };
            
            game.enemies.push(enemy);
            game.enemiesLeft--;
            updateWaveInfo();
            
            // Agenda próximo inimigo se ainda houver
            if (game.enemiesLeft > 0 && !game.bossActive) {
                const spawnDelay = 1000 - (game.wave * 20);
                setTimeout(spawnEnemy, Math.max(200, spawnDelay));
            }
        }

        function gameLoop(timestamp) {
            if (game.gameOver || game.paused) return;
            
            const deltaTime = timestamp - game.lastTime;
            game.lastTime = timestamp;
            
            update(deltaTime);
            render();
            
            requestAnimationFrame(gameLoop);
        }

        function update(deltaTime) {
            // Atualiza jogador
            updatePlayer();
            
            // Atualiza estrelas (efeito parallax)
            updateStars();
            
            // Atualiza inimigos
            updateEnemies();
            
            // Atualiza tiros
            updateBullets();
            
            // Atualiza power-ups
            updatePowerups();
            
            // Atualiza partículas
            updateParticles();
            
            // Verifica se a wave acabou
            if (game.enemies.length === 0 && game.enemiesLeft === 0 && !game.bossActive) {
                game.coins += config.coinsPerWave * game.wave;
                game.wave++;
                updateWaveInfo();
                updateUI();
                startWave();
            }
        }

        function updatePlayer() {
            // Movimento
            const speed = config.playerSpeed * (1 + game.upgrades.speed.level * 0.1);
            
            if (game.keys['ArrowLeft'] || game.keys['a']) {
                game.player.x -= speed;
            }
            if (game.keys['ArrowRight'] || game.keys['d']) {
                game.player.x += speed;
            }
            if (game.keys['ArrowUp'] || game.keys['w']) {
                game.player.y -= speed;
            }
            if (game.keys['ArrowDown'] || game.keys['s']) {
                game.player.y += speed;
            }
            
            // Disparo com setas direcionais
            const shootDelay = game.player.shootDelay / (1 + game.upgrades.fireRate.level * 0.15);
            const now = Date.now();
            
            if ((game.keys[' '] || game.keys['z']) && now - game.player.lastShot > shootDelay) {
                shoot(0, -1); // Tiro para cima
                game.player.lastShot = now;
            }
            
            if (game.keys['ArrowUp'] && now - game.player.lastShot > shootDelay) {
                shoot(0, -1); // Tiro para cima
                game.player.lastShot = now;
            }
            if (game.keys['ArrowRight'] && now - game.player.lastShot > shootDelay) {
                shoot(1, 0); // Tiro para direita
                game.player.lastShot = now;
            }
            if (game.keys['ArrowDown'] && now - game.player.lastShot > shootDelay) {
                shoot(0, 1); // Tiro para baixo
                game.player.lastShot = now;
            }
            if (game.keys['ArrowLeft'] && now - game.player.lastShot > shootDelay) {
                shoot(-1, 0); // Tiro para esquerda
                game.player.lastShot = now;
            }
            
            // Limites da tela
            game.player.x = Math.max(0, Math.min(game.canvas.width - game.player.width, game.player.x));
            game.player.y = Math.max(0, Math.min(game.canvas.height - game.player.height, game.player.y));
        }

        function shoot(dirX, dirY) {
            const damage = 10 * (1 + game.upgrades.damage.level * 0.2);
            const bulletSize = 4 + game.upgrades.damage.level * 0.5;
            
            // Tiro central
            game.bullets.push({
                x: game.player.x + game.player.width / 2 - bulletSize/2,
                y: game.player.y + game.player.height / 2 - bulletSize/2,
                width: bulletSize,
                height: bulletSize,
                speedX: dirX * config.bulletSpeed * 1.5,
                speedY: dirY * config.bulletSpeed * 1.5,
                damage: damage,
                color: game.player.skins[game.player.skin].color
            });
            
            // Tiros laterais no level 5+
            if (game.level >= 5) {
                game.bullets.push({
                    x: game.player.x + 10,
                    y: game.player.y + game.player.height / 2 - bulletSize/2,
                    width: bulletSize,
                    height: bulletSize,
                    speedX: dirX * config.bulletSpeed * 1.5,
                    speedY: dirY * config.bulletSpeed * 1.5,
                    damage: damage * 0.8,
                    color: game.player.skins[game.player.skin].color
                });
                
                game.bullets.push({
                    x: game.player.x + game.player.width - 10 - bulletSize,
                    y: game.player.y + game.player.height / 2 - bulletSize/2,
                    width: bulletSize,
                    height: bulletSize,
                    speedX: dirX * config.bulletSpeed * 1.5,
                    speedY: dirY * config.bulletSpeed * 1.5,
                    damage: damage * 0.8,
                    color: game.player.skins[game.player.skin].color
                });
            }
            
            // Efeito sonoro (simulado)
            createParticles(
                game.player.x + game.player.width / 2, 
                game.player.y + game.player.height / 2, 
                5, 
                game.player.skins[game.player.skin].color
            );
        }

        function updateEnemies() {
            game.enemies.forEach((enemy, index) => {
                // Movimento especial para boss
                if (game.bossActive && enemy === game.currentBoss) {
                    updateBossMovement(enemy);
                } else {
                    // Movimento padrão para inimigos normais
                    if (game.wave > 3) {
                        // Inimigos mais inteligentes em waves altas
                        enemy.direction += (Math.random() - 0.5) * 0.2;
                        
                        // Tenta seguir o jogador
                        const angleToPlayer = Math.atan2(
                            game.player.y + game.player.height/2 - (enemy.y + enemy.height/2),
                            game.player.x + game.player.width/2 - (enemy.x + enemy.width/2)
                        );
                        
                        enemy.direction = angleToPlayer * 0.1 + enemy.direction * 0.9;
                        
                        enemy.x += Math.cos(enemy.direction) * enemy.speed;
                        enemy.y += Math.sin(enemy.direction) * enemy.speed;
                    } else {
                        // Movimento simples para waves baixas
                        enemy.y += enemy.speed;
                    }
                }
                
                // Disparo de inimigos
                if (Date.now() - enemy.lastShot > enemy.shootDelay && Math.random() < 0.02) {
                    enemyShoot(enemy);
                    enemy.lastShot = Date.now();
                }
                
                // Verifica colisão com jogador
                if (checkCollision(
                    game.player.x, game.player.y, game.player.width, game.player.height,
                    enemy.x, enemy.y, enemy.width, enemy.height
                )) {
                    takeDamage(10 + game.wave);
                    createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2, enemy.width);
                    
                    if (game.bossActive && enemy === game.currentBoss) {
                        game.bossActive = false;
                        document.getElementById('bossName').style.display = 'none';
                        document.getElementById('bossHealth').style.display = 'none';
                        game.currentBoss = null;
                    }
                    
                    game.enemies.splice(index, 1);
                    return;
                }
                
                // Saiu da tela (não aplicável a boss)
                if (!game.bossActive && (
                    enemy.y > game.canvas.height + enemy.height ||
                    enemy.y < -enemy.height * 2 ||
                    enemy.x > game.canvas.width + enemy.width ||
                    enemy.x < -enemy.width * 2
                )) {
                    game.enemies.splice(index, 1);
                    
                    // Se não for boss, conta como inimigo perdido
                    if (game.enemiesLeft > 0) {
                        game.enemiesLeft--;
                        updateWaveInfo();
                    }
                }
            });
        }

        function updateBossMovement(boss) {
            switch (boss.pattern) {
                case 'horizontal':
                    boss.x += boss.speed;
                    if (boss.x <= 0 || boss.x + boss.width >= game.canvas.width) {
                        boss.speed *= -1;
                    }
                    break;
                    
                case 'vertical':
                    boss.y += boss.speed;
                    if (boss.y <= 50 || boss.y + boss.height >= game.canvas.height / 2) {
                        boss.speed *= -1;
                    }
                    break;
                    
                case 'spiral':
                    boss.spiralAngle = boss.spiralAngle || 0;
                    boss.spiralRadius = boss.spiralRadius || 0;
                    
                    boss.spiralAngle += 0.02;
                    boss.spiralRadius += 0.1;
                    
                    boss.x = game.canvas.width / 2 - boss.width / 2 + Math.cos(boss.spiralAngle) * boss.spiralRadius * 50;
                    boss.y = 100 + Math.sin(boss.spiralAngle) * boss.spiralRadius * 30;
                    
                    if (boss.spiralRadius > 3) boss.spiralRadius = 0;
                    break;
            }
            
            updateBossHealth();
        }

        function enemyShoot(enemy) {
            if (game.gameOver) return;
            
            const isBoss = game.bossActive && enemy === game.currentBoss;
            
            if (isBoss) {
                // Padrão de tiro do boss
                for (let i = 0; i < enemy.bullets; i++) {
                    const angle = (Math.PI * 2 / enemy.bullets) * i;
                    
                    game.bullets.push({
                        x: enemy.x + enemy.width / 2 - 3,
                        y: enemy.y + enemy.height / 2 - 3,
                        width: 8,
                        height: 8,
                        speedX: Math.cos(angle) * 4,
                        speedY: Math.sin(angle) * 4,
                        damage: 10 + game.wave,
                        color: enemy.color
                    });
                }
            } else {
                // Tiro de inimigo normal
                const angleToPlayer = Math.atan2(
                    game.player.y + game.player.height/2 - (enemy.y + enemy.height/2),
                    game.player.x + game.player.width/2 - (enemy.x + enemy.width/2)
                );
                
                game.bullets.push({
                    x: enemy.x + enemy.width / 2 - 3,
                    y: enemy.y + enemy.height / 2 - 3,
                    width: 6,
                    height: 6,
                    speedX: Math.cos(angleToPlayer) * 3,
                    speedY: Math.sin(angleToPlayer) * 3,
                    damage: 5 + game.wave,
                    color: enemy.color
                });
            }
            
            createParticles(
                enemy.x + enemy.width / 2, 
                enemy.y + enemy.height / 2, 
                5, 
                enemy.color
            );
        }

        function updateBullets() {
            game.bullets.forEach((bullet, index) => {
                // Movimento
                bullet.x += bullet.speedX;
                bullet.y += bullet.speedY;
                
                // Verifica se saiu da tela
                if (bullet.x < -bullet.width || 
                    bullet.x > game.canvas.width || 
                    bullet.y < -bullet.height || 
                    bullet.y > game.canvas.height) {
                    game.bullets.splice(index, 1);
                    return;
                }
                
                // Verifica colisão com inimigos (tiros do jogador)
                if (bullet.speedY < 0 || Math.abs(bullet.speedX) > 0) {
                    game.enemies.forEach((enemy, enemyIndex) => {
                        if (checkCollision(
                            bullet.x, bullet.y, bullet.width, bullet.height,
                            enemy.x, enemy.y, enemy.width, enemy.height
                        )) {
                            enemy.health -= bullet.damage;
                            createParticles(bullet.x + bullet.width/2, bullet.y + bullet.height/2, 3, bullet.color);
                            game.bullets.splice(index, 1);
                            
                            if (enemy.health <= 0) {
                                game.score += enemy.value;
                                game.coins += config.coinsPerKill * (1 + Math.floor(game.wave / 3));
                                updateUI();
                                createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2, enemy.width);
                                
                                if (game.bossActive && enemy === game.currentBoss) {
                                    game.bossActive = false;
                                    document.getElementById('bossName').style.display = 'none';
                                    document.getElementById('bossHealth').style.display = 'none';
                                    game.currentBoss = null;
                                }
                                
                                game.enemies.splice(enemyIndex, 1);
                                
                                // Chance de dropar power-up
                                if (Math.random() < config.powerupChance) {
                                    spawnPowerup();
                                }
                            } else if (game.bossActive && enemy === game.currentBoss) {
                                updateBossHealth();
                            }
                            return;
                        }
                    });
                }
                
                // Verifica colisão com jogador (tiros de inimigos)
                if (bullet.speedY > 0 || Math.abs(bullet.speedX) > 0) {
                    if (checkCollision(
                        bullet.x, bullet.y, bullet.width, bullet.height,
                        game.player.x, game.player.y, game.player.width, game.player.height
                    )) {
                        takeDamage(bullet.damage);
                        createParticles(bullet.x + bullet.width/2, bullet.y + bullet.height/2, 10, '#ff0000');
                        game.bullets.splice(index, 1);
                        return;
                    }
                }
            });
        }

        function updateStars() {
            game.stars.forEach(star => {
                star.y += star.speed;
                if (star.y > game.canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * game.canvas.width;
                }
                
                // Piscar aleatoriamente
                if (Math.random() < 0.01) {
                    star.opacity = Math.random();
                }
            });
        }

        function updatePowerups() {
            game.powerups.forEach((powerup, index) => {
                // Movimento
                powerup.y += powerup.speed;
                
                // Verifica colisão com jogador
                if (!powerup.collected && checkCollision(
                    game.player.x, game.player.y, game.player.width, game.player.height,
                    powerup.x, powerup.y, powerup.width, powerup.height
                )) {
                    collectPowerup(powerup);
                    powerup.collected = true;
                    game.powerups.splice(index, 1);
                    return;
                }
                
                // Saiu da tela
                if (powerup.y > game.canvas.height) {
                    game.powerups.splice(index, 1);
                }
            });
        }

        function spawnPowerup(type) {
            if (!type) {
                const types = ['health', 'coins', 'fireRate', 'damage', 'speed'];
                type = types[Math.floor(Math.random() * types.length)];
            }
            
            let color, effect;
            switch (type) {
                case 'health':
                    color = '#00ff00';
                    effect = '+20% health';
                    break;
                case 'coins':
                    color = '#ffff00';
                    effect = `+${50 + game.wave * 10} coins`;
                    break;
                case 'fireRate':
                    color = '#ff9900';
                    effect = 'Fire rate +';
                    break;
                case 'damage':
                    color = '#ff3300';
                    effect = 'Damage +';
                    break;
                case 'speed':
                    color = '#0099ff';
                    effect = 'Speed +';
                    break;
            }
            
            game.powerups.push({
                x: Math.random() * (game.canvas.width - 30),
                y: -30,
                width: 30,
                height: 30,
                speed: 2,
                type: type,
                color: color,
                effect: effect,
                collected: false
            });
        }

        function collectPowerup(powerup) {
            createParticles(powerup.x + powerup.width/2, powerup.y + powerup.height/2, 15, powerup.color);
            
            switch (powerup.type) {
                case 'health':
                    game.player.health = Math.min(game.player.maxHealth, game.player.health + 20);
                    break;
                case 'coins':
                    const coins = 50 + game.wave * 10;
                    game.coins += coins;
                    powerup.effect = `+${coins} coins`;
                    break;
                case 'fireRate':
                    game.player.shootDelay = Math.max(100, game.player.shootDelay - 50);
                    break;
                case 'damage':
                    // Efeito temporário de dano
                    showFloatingText('Damage Boost!', powerup.x, powerup.y, '#ff3300');
                    break;
                case 'speed':
                    // Efeito temporário de velocidade
                    showFloatingText('Speed Boost!', powerup.x, powerup.y, '#0099ff');
                    break;
            }
            
            updateUI();
            showFloatingText(powerup.effect, powerup.x, powerup.y, powerup.color);
        }

        function showFloatingText(text, x, y, color) {
            const message = document.createElement('div');
            message.className = 'floating-text';
            message.textContent = text;
            message.style.left = x + 'px';
            message.style.top = y + 'px';
            message.style.color = color || '#fff';
            document.body.appendChild(message);
            
            setTimeout(() => {
                document.body.removeChild(message);
            }, 1500);
        }

        function takeDamage(amount) {
            if (game.gameOver) return;
            
            game.player.health -= amount;
            updateUI();
            
            // Efeito de dano na tela
            game.canvas.style.boxShadow = 'inset 0 0 30px red';
            setTimeout(() => {
                game.canvas.style.boxShadow = 'none';
            }, 200);
            
            // Verifica game over
            if (game.player.health <= 0) {
                if (game.upgrades.extraLives.count > 0) {
                    game.upgrades.extraLives.count--;
                    game.player.health = game.player.maxHealth * 0.5;
                    updateUI();
                    showFloatingText('Vida Extra Usada!', game.player.x, game.player.y, '#00ff00');
                } else {
                    game.player.health = 0;
                    gameOver();
                }
            }
        }

        function gameOver() {
            game.gameOver = true;
            
            // Cria uma grande explosão
            createExplosion(game.player.x + game.player.width/2, game.player.y + game.player.height/2, 100);
            
            // Mostra tela de game over
            setTimeout(() => {
                const gameOverScreen = document.createElement('div');
                gameOverScreen.style.position = 'absolute';
                gameOverScreen.style.top = '0';
                gameOverScreen.style.left = '0';
                gameOverScreen.style.width = '100%';
                gameOverScreen.style.height = '100%';
                gameOverScreen.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
                gameOverScreen.style.display = 'flex';
                gameOverScreen.style.flexDirection = 'column';
                gameOverScreen.style.justifyContent = 'center';
                gameOverScreen.style.alignItems = 'center';
                gameOverScreen.style.zIndex = '1000';
                
                const gameOverText = document.createElement('h1');
                gameOverText.textContent = 'GAME OVER';
                gameOverText.style.color = '#ff0000';
                gameOverText.style.fontSize = '4rem';
                gameOverText.style.marginBottom = '2rem';
                gameOverText.style.textShadow = '0 0 10px #ff0000';
                
                const scoreText = document.createElement('div');
                scoreText.textContent = `Score: ${game.score}`;
                scoreText.style.color = '#ffffff';
                scoreText.style.fontSize = '2rem';
                scoreText.style.marginBottom = '1rem';
                
                const waveText = document.createElement('div');
                waveText.textContent = `Wave: ${game.wave}`;
                waveText.style.color = '#ffffff';
                waveText.style.fontSize = '2rem';
                waveText.style.marginBottom = '2rem';
                
                const restartButton = document.createElement('button');
                restartButton.textContent = 'Tentar Novamente';
                restartButton.style.padding = '15px 40px';
                restartButton.style.fontSize = '1.5rem';
                restartButton.style.background = 'linear-gradient(to right, #ff3300, #ff6600)';
                restartButton.style.color = 'white';
                restartButton.style.border = 'none';
                restartButton.style.borderRadius = '50px';
                restartButton.style.cursor = 'pointer';
                restartButton.style.boxShadow = '0 0 15px #ff3300';
                restartButton.addEventListener('click', () => {
                    document.body.removeChild(gameOverScreen);
                    startGame();
                });
                
                gameOverScreen.appendChild(gameOverText);
                gameOverScreen.appendChild(scoreText);
                gameOverScreen.appendChild(waveText);
                gameOverScreen.appendChild(restartButton);
                document.body.appendChild(gameOverScreen);
            }, 1000);
        }

        function updateParticles() {
            game.particles.forEach((particle, index) => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life--;
                
                if (particle.life <= 0) {
                    game.particles.splice(index, 1);
                }
            });
        }

        function createParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                game.particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * 4 + 1,
                    color: color,
                    vx: Math.random() * 6 - 3,
                    vy: Math.random() * 6 - 3,
                    life: Math.random() * 30 + 20
                });
            }
        }

        function createExplosion(x, y, size) {
            const particleCount = Math.floor(size / 2);
            for (let i = 0; i < particleCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * size / 5;
                
                game.particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * 5 + 2,
                    color: `hsl(${Math.random() * 30 + 20}, 100%, 50%)`,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: Math.random() * 60 + 30
                });
            }
            
            // Efeito de onda de choque
            for (let i = 0; i < 3; i++) {
                game.particles.push({
                    x: x,
                    y: y,
                    size: 0,
                    color: `rgba(255, ${Math.random() * 100 + 155}, 0, 0.8)`,
                    vx: 0,
                    vy: 0,
                    life: 30 + i * 10,
                    growing: true,
                    maxSize: size * (i + 1)
                });
            }
        }

        function checkCollision(x1, y1, w1, h1, x2, y2, w2, h2) {
            return x1 < x2 + w2 &&
                   x1 + w1 > x2 &&
                   y1 < y2 + h2 &&
                   y1 + h1 > y2;
        }

        function updateUI() {
            document.getElementById('score').textContent = game.score;
            document.getElementById('level').textContent = game.level;
            document.getElementById('health').textContent = game.player.health;
            document.getElementById('coins').textContent = game.coins;
            
            // Atualiza barra de level
            const levelPercent = (game.levelProgress / config.levelThreshold) * 100;
            document.getElementById('levelProgress').style.width = `${levelPercent}%`;
            document.getElementById('levelText').textContent = 
                levelPercent >= 100 ? 'LEVEL UP!' : `Level ${game.level} (${Math.floor(levelPercent)}%)`;
        }

        function updateWaveInfo() {
            document.getElementById('wave').textContent = game.wave;
            document.getElementById('enemiesLeft').textContent = game.enemiesLeft;
        }

        function openShop() {
            document.getElementById('shopScreen').style.display = 'flex';
            document.getElementById('shopCoins').textContent = game.coins;
            updateShopButtons();
        }

        function closeShop() {
            document.getElementById('shopScreen').style.display = 'none';
        }

        function updateShopButtons() {
            // Atualiza textos e botões da loja
            document.getElementById('healthLevel').textContent = game.upgrades.health.level;
            document.getElementById('healthCost').textContent = Math.floor(game.upgrades.health.cost);
            document.getElementById('upgradeHealth').disabled = 
                game.upgrades.health.level >= game.upgrades.health.max || 
                game.coins < game.upgrades.health.cost;
            
            document.getElementById('damageLevel').textContent = game.upgrades.damage.level;
            document.getElementById('damageCost').textContent = Math.floor(game.upgrades.damage.cost);
            document.getElementById('upgradeDamage').disabled = 
                game.upgrades.damage.level >= game.upgrades.damage.max || 
                game.coins < game.upgrades.damage.cost;
            
            document.getElementById('fireRateLevel').textContent = game.upgrades.fireRate.level;
            document.getElementById('fireRateCost').textContent = Math.floor(game.upgrades.fireRate.cost);
            document.getElementById('upgradeFireRate').disabled = 
                game.upgrades.fireRate.level >= game.upgrades.fireRate.max || 
                game.coins < game.upgrades.fireRate.cost;
            
            document.getElementById('speedLevel').textContent = game.upgrades.speed.level;
            document.getElementById('speedCost').textContent = Math.floor(game.upgrades.speed.cost);
            document.getElementById('upgradeSpeed').disabled = 
                game.upgrades.speed.level >= game.upgrades.speed.max || 
                game.coins < game.upgrades.speed.cost;
            
            document.getElementById('extraLifeCost').textContent = game.upgrades.extraLives.cost;
            document.getElementById('extraLives').textContent = `${game.upgrades.extraLives.count}/${game.upgrades.extraLives.max}`;
            document.getElementById('buyExtraLife').disabled = 
                game.upgrades.extraLives.count >= game.upgrades.extraLives.max || 
                game.coins < game.upgrades.extraLives.cost;
        }

        function upgradeStat(stat) {
            const upgrade = game.upgrades[stat];
            
            if (game.coins >= upgrade.cost && upgrade.level < upgrade.max) {
                game.coins -= Math.floor(upgrade.cost);
                upgrade.level++;
                upgrade.cost *= upgrade.costMultiplier;
                
                // Aplica efeitos
                if (stat === 'health') {
                    const healthIncrease = 20;
                    game.player.maxHealth += healthIncrease;
                    game.player.health += healthIncrease;
                }
                
                updateUI();
                updateShopButtons();
                showFloatingText(`${stat} upgraded!`, game.canvas.width/2, game.canvas.height/2, '#00ff00');
            }
        }

        function buyExtraLife() {
            const extraLife = game.upgrades.extraLives;
            
            if (game.coins >= extraLife.cost && extraLife.count < extraLife.max) {
                game.coins -= Math.floor(extraLife.cost);
                extraLife.count++;
                extraLife.cost *= extraLife.costMultiplier;
                
                updateUI();
                updateShopButtons();
                showFloatingText('Vida Extra Adquirida!', game.canvas.width/2, game.canvas.height/2, '#00ff00');
            }
        }

        function handleKeyDown(e) {
            game.keys[e.key] = true;
            
            // Pausa o jogo com ESC
            if (e.key === 'Escape') {
                game.paused = !game.paused;
                if (!game.paused && !game.gameOver) {
                    requestAnimationFrame(gameLoop);
                }
            }
            
            // Abre loja com L
            if (e.key === 'l' || e.key === 'L') {
                openShop();
            }
        }

        function handleKeyUp(e) {
            game.keys[e.key] = false;
        }

        // Inicia o jogo quando a página carrega
        window.addEventListener('load', init);
    </script>
</body>
</html>